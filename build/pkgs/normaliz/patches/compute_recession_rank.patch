Part of upstream commit "Bug fix affine dim" fbec6fdbfe242f12a3f88d9e37e835f9686becc5

diff --git a/source/libnormaliz/cone.cpp b/source/libnormaliz/cone.cpp
index 4e416a75..2a5e0f61 100644
--- a/source/libnormaliz/cone.cpp
+++ b/source/libnormaliz/cone.cpp
@@ -4284,7 +4284,7 @@ void Cone<Integer>::compute_recession_rank() {
     compute(ConeProperty::ExtremeRays);
     vector<key_t> level0key;
     Matrix<Integer> Help=BasisChangePointed.to_sublattice(ExtremeRays);
-    vector<Integer> HelpDehom=BasisChangePointed.to_sublattice(Dehomogenization);
+    vector<Integer> HelpDehom=BasisChangePointed.to_sublattice_dual(Dehomogenization);
     for(size_t i=0; i < Help.nr_of_rows(); ++i){
         if(v_scalar_product(Help[i],HelpDehom)==0)
             level0key.push_back(i);
diff --git a/test/Makefile.am b/test/Makefile.am
index b9723850..d44e632f 100644
--- a/test/Makefile.am
+++ b/test/Makefile.am
@@ -156,9 +156,11 @@ NMZTESTS = test-/23.in					\
 	test-/intcl1.in					\
 	test-/intcl1.ref				\
 	test-/isIC.in					\
-	test-/isIC.ref				\
+	test-/isIC.ref					\
 	test-/ispointed.in				\
 	test-/ispointed.ref				\
+	test-/jonagold.in				\
+	test-/jonagold.ref				\
 	test-/knapsack_11_60_test2.in			\
 	test-/knapsack_11_60_test2.ref			\
 	test-/latt_cong.in				\
@@ -166,7 +168,7 @@ NMZTESTS = test-/23.in					\
 	test-/latt_id_nonpointed.in			\
 	test-/latt_id_nonpointed.ref			\
 	test-/latt_ineq.in			 	\
-	test-/latt_ineq.ref			\
+	test-/latt_ineq.ref				\
 	test-/lattice_ideal.in				\
 	test-/lattice_ideal.ref				\
 	test-/lowrank.in				\
diff --git a/test/test-/jonagold.in b/test/test-/jonagold.in
new file mode 100644
index 00000000..e4cdabe6
--- /dev/null
+++ b/test/test-/jonagold.in
@@ -0,0 +1,23 @@
+amb_space 4
+grading
+0 0 0 1
+extreme_rays 6
+ 1 2 3 1
+ 1 3 2 1
+ 2 1 3 1
+ 2 3 1 1
+ 3 1 2 1
+ 3 2 1 1
+support_hyperplanes 6
+ -1 -1 0  5
+ -1  0 0  3
+  0 -1 0  3
+  0  1 0 -1
+  1  0 0 -1
+  1  1 0 -3
+generated_lattice 3
+ 1 0 -1 0
+ 0 1 -1 0
+ 0 0  6 1
+dehomogenization
+0 0 0 1
diff --git a/test/test-/jonagold.ref b/test/test-/jonagold.ref
new file mode 100644
index 00000000..bbf03934
--- /dev/null
+++ b/test/test-/jonagold.ref
@@ -0,0 +1,74 @@
+7 lattice points in polytope (module generators)
+0 Hilbert basis elements of recession monoid
+6 vertices of polyhedron
+0 extreme rays of recession cone
+6 support hyperplanes of polyhedron (homogenized)
+
+embedding dimension = 4
+affine dimension of the polyhedron = 2
+rank of recession monoid = 0 (polyhedron is polytope)
+
+dehomogenization:
+0 0 0 1 
+
+grading:
+0 0 0 1 
+
+
+module rank = 7
+multiplicity = 7
+
+Hilbert series:
+7 
+denominator with 0 factors:
+
+
+shift = 1
+
+degree of Hilbert Series as rational function = 1
+
+The numerator of the Hilbert series is symmetric.
+
+Hilbert polynomial:
+
+with common denominator = 1
+
+***********************************************************************
+
+7 lattice points in polytope (module generators):
+ 1 2 3 1
+ 1 3 2 1
+ 2 1 3 1
+ 2 2 2 1
+ 2 3 1 1
+ 3 1 2 1
+ 3 2 1 1
+
+0 Hilbert basis elements of recession monoid:
+
+6 vertices of polyhedron:
+ 1 2 3 1
+ 1 3 2 1
+ 2 1 3 1
+ 2 3 1 1
+ 3 1 2 1
+ 3 2 1 1
+
+0 extreme rays of recession cone:
+
+6 support hyperplanes of polyhedron (homogenized):
+ -1 -1  5 0
+ -1  1  1 0
+ -1  5 -1 0
+  1 -1  1 0
+  1  1 -1 0
+  5 -1 -1 0
+
+1 equations:
+ 1 1 1 -6
+
+3 basis elements of generated  lattice:
+ 1 0 -1 0
+ 0 1 -1 0
+ 0 0  6 1
+
